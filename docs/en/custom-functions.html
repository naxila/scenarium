<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Functions - Scenarium Documentation</title>
</head>
<body>
    <div class="main-content">
        <div class="content">
            <section class="section">
                <h1>üîß Custom Functions</h1>
                <p class="lead">Learn how to create and register custom functions for text interpolation and data processing.</p>
                
                <h2>What are Custom Functions?</h2>
                <p>Custom functions allow you to process data and perform calculations that can be used in object function syntax.</p>
                
                <h2>Creating a Custom Function</h2>
                <p>To create a custom function, create a class with the following structure:</p>
                
                <div class="code-block">
                    <h3>Custom Function Structure</h3>
                    <pre><code class="language-javascript">class MyCustomFunction {
  get functionName() { return 'MyFunction'; }

  async execute(params, context) {
    const interpolationContext = context.interpolationContext;
    
    if (!interpolationContext) {
      throw new Error('MyCustomFunction: interpolationContext is required');
    }
    
    // Your function logic here
    return result;
  }
}

module.exports = { MyCustomFunction };</code></pre>
                </div>
                
                <h2>Example: String Functions</h2>
                <div class="example-card">
                    <h3>String Function Implementation</h3>
                    <pre><code class="language-javascript">const { InterpolationSystem } = require('scenarium');

class StringFunction {
  get functionName() { return 'String'; }

  async execute(params, context) {
    const interpolationContext = context.interpolationContext;
    
    if (!interpolationContext) {
      throw new Error('StringFunction: interpolationContext is required');
    }
    
    const operation = InterpolationSystem.interpolate(params.operation, interpolationContext);
    const input = InterpolationSystem.interpolate(params.input, interpolationContext);
    
    switch (operation) {
      case 'uppercase':
        return String(input).toUpperCase();
      case 'lowercase':
        return String(input).toLowerCase();
      case 'reverse':
        return String(input).split('').reverse().join('');
      case 'length':
        return String(input).length;
      default:
        throw new Error(`Unknown string operation: ${operation}`);
    }
  }
}

module.exports = { StringFunction };</code></pre>
                </div>
                
                <h2>Registering Custom Functions</h2>
                <p>Use the <code>RegistryManager</code> to register your custom functions:</p>
                
                <div class="code-block">
                    <h3>Registration Example</h3>
                    <pre><code class="language-javascript">const { RegistryManager } = require('scenarium');
const { StringFunction } = require('./functions/StringFunction');

// Register the custom function
RegistryManager.registerFunctions({
  'String': new StringFunction()
}, {
  overwrite: true,
  verbose: true
});</code></pre>
                </div>
                
                <h2>Using Custom Functions in Scenarios</h2>
                <p>Once registered, you can use your custom function in scenario JSON. <strong>Important:</strong> Custom functions must be used in object syntax, not in string interpolation:</p>
                
                <div class="code-block">
                    <h3>‚ùå Incorrect (String Interpolation)</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Result: {{function: {String: {operation: 'uppercase', input: 'hello'}}}}"
}</code></pre>
                </div>
                
                <div class="code-block">
                    <h3>‚úÖ Correct (Object Syntax)</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": {
    "function": "JoinToString",
    "values": [
      "Result: ",
      {
        "function": "String",
        "operation": "uppercase",
        "input": "hello"
      }
    ],
    "separator": ""
  }
}</code></pre>
                </div>
                
                <div class="example-card">
                    <h3>Scenario with Custom Function</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": {
    "function": "JoinToString",
    "values": [
      "‚Ä¢ uppercase('hello') = ",
      {
        "function": "String",
        "operation": "uppercase",
        "input": "hello"
      }
    ],
    "separator": ""
  }
}</code></pre>
                </div>
                
                <div class="example-card">
                    <h3>Multiple Function Examples</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Function results:"
},
{
  "action": "SendMessage",
  "text": {
    "function": "JoinToString",
    "values": [
      "‚Ä¢ uppercase('hello') = ",
      {
        "function": "String",
        "operation": "uppercase",
        "input": "hello"
      }
    ],
    "separator": ""
  }
},
{
  "action": "SendMessage",
  "text": {
    "function": "JoinToString",
    "values": [
      "‚Ä¢ length('test') = ",
      {
        "function": "String",
        "operation": "length",
        "input": "test"
      }
    ],
    "separator": ""
  }
},
{
  "action": "SendMessage",
  "text": {
    "function": "JoinToString",
    "values": [
      "‚Ä¢ reverse('12345') = ",
      {
        "function": "String",
        "operation": "reverse",
        "input": "12345"
      }
    ],
    "separator": ""
  }
}</code></pre>
                </div>
                
                <h2>Example: Math Function</h2>
                <div class="example-card">
                    <h3>Math Function Implementation</h3>
                    <pre><code class="language-javascript">const { InterpolationSystem } = require('scenarium');

class MathFunction {
  get functionName() { return 'Math'; }

  async execute(params, context) {
    const interpolationContext = context.interpolationContext;
    
    if (!interpolationContext) {
      throw new Error('MathFunction: interpolationContext is required');
    }
    
    const operation = InterpolationSystem.interpolate(params.operation, interpolationContext);
    const values = InterpolationSystem.interpolate(params.values, interpolationContext);
    
    switch (operation) {
      case 'sum':
        if (!Array.isArray(values)) throw new Error('MathFunction: sum operation requires an array of values');
        return values.reduce((acc, val) => acc + parseFloat(val), 0);
      case 'max':
        if (!Array.isArray(values)) throw new Error('MathFunction: max operation requires an array of values');
        return Math.max(...values.map(parseFloat));
      case 'min':
        if (!Array.isArray(values)) throw new Error('MathFunction: min operation requires an array of values');
        return Math.min(...values.map(parseFloat));
      default:
        throw new Error(`Unknown math operation: ${operation}`);
    }
  }
}

module.exports = { MathFunction };</code></pre>
                </div>
                
                <div class="example-card">
                    <h3>Math Function Usage in Scenario</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": {
    "function": "JoinToString",
    "values": [
      "‚Ä¢ sum([1,2,3,4,5]) = ",
      {
        "function": "Math",
        "operation": "sum",
        "values": [1,2,3,4,5]
      }
    ],
    "separator": ""
  }
},
{
  "action": "SendMessage",
  "text": {
    "function": "JoinToString",
    "values": [
      "‚Ä¢ max([10,5,8,15,3]) = ",
      {
        "function": "Math",
        "operation": "max",
        "values": [10,5,8,15,3]
      }
    ],
    "separator": ""
  }
}</code></pre>
                </div>
                
                <h2>Demo Project</h2>
                <p>Check out the complete working example in the <code>custom-actions-functions</code> demo project:</p>
                <ul>
                    <li><strong>StringFunction</strong> - String manipulation operations</li>
                    <li><strong>MathFunction</strong> - Mathematical calculations</li>
                    <li><strong>DateFunction</strong> - Date and time operations</li>
                </ul>
                <p>Run the demo: <code>cd examples/custom-actions-functions && npm install && node index.js</code></p>
                
                <h2>Best Practices</h2>
                <ul>
                    <li>Use clear, descriptive names for your functions</li>
                    <li>Handle invalid parameters gracefully</li>
                    <li>Keep functions pure when possible (no side effects)</li>
                    <li>Use async functions for operations that require external data</li>
                    <li>Always check for <code>interpolationContext</code> availability</li>
                    <li>Use <code>InterpolationSystem.interpolate()</code> for parameter processing</li>
                </ul>
            </section>
        </div>
    </div>
</body>
</html>
