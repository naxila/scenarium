<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RequestApi - Scenarium - Telegram Bot Constructor</title>
</head>
<body>
    <div class="main-content">
        <div class="content">

                <section class="section">
                    <h1>üåê RequestApi</h1>
                    <p class="lead">Execute HTTP requests to external APIs with support for all methods and response handling.</p>
                    
                    <div class="action-info">
                        <div class="info-card">
                            <h3>üìã Description</h3>
                            <p>RequestApi is an action for executing HTTP requests to external APIs. Supports all HTTP methods, parameter interpolation and response handling.</p>
                        </div>
                        
                        <div class="info-card">
                            <h3>üéØ Purpose</h3>
                            <ul>
                                <li>Integrate with external APIs</li>
                                <li>Get data from services</li>
                                <li>Send data to server</li>
                                <li>Handle responses and errors</li>
                            </ul>
                        </div>
                    </div>

                    <h2>‚öôÔ∏è Parameters</h2>
                    <div class="params-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Default</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>method</code></td>
                                    <td>string</td>
                                    <td>‚ùå</td>
                                    <td>GET</td>
                                    <td>HTTP method (GET, POST, PUT, DELETE, etc.)</td>
                                </tr>
                                <tr>
                                    <td><code>path</code></td>
                                    <td>string</td>
                                    <td>‚ùå</td>
                                    <td>''</td>
                                    <td>API path</td>
                                </tr>
                                <tr>
                                    <td><code>baseUrl</code></td>
                                    <td>string</td>
                                    <td>‚ùå</td>
                                    <td>''</td>
                                    <td>Base URL</td>
                                </tr>
                                <tr>
                                    <td><code>params</code></td>
                                    <td>object</td>
                                    <td>‚ùå</td>
                                    <td>{}</td>
                                    <td>Query parameters</td>
                                </tr>
                                <tr>
                                    <td><code>body</code></td>
                                    <td>any</td>
                                    <td>‚ùå</td>
                                    <td>-</td>
                                    <td>Request body</td>
                                </tr>
                                <tr>
                                    <td><code>headers</code></td>
                                    <td>object</td>
                                    <td>‚ùå</td>
                                    <td>{}</td>
                                    <td>HTTP headers</td>
                                </tr>
                                <tr>
                                    <td><code>timeoutMs</code></td>
                                    <td>number</td>
                                    <td>‚ùå</td>
                                    <td>15000</td>
                                    <td>Timeout in milliseconds</td>
                                </tr>
                                <tr>
                                    <td><code>onStart</code></td>
                                    <td>action</td>
                                    <td>‚ùå</td>
                                    <td>-</td>
                                    <td>Action before request</td>
                                </tr>
                                <tr>
                                    <td><code>onSuccess</code></td>
                                    <td>action</td>
                                    <td>‚ùå</td>
                                    <td>-</td>
                                    <td>Action on success</td>
                                </tr>
                                <tr>
                                    <td><code>onFailure</code></td>
                                    <td>action</td>
                                    <td>‚ùå</td>
                                    <td>-</td>
                                    <td>Action on error</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h2>üí° Usage Examples</h2>
                    
                    <div class="example-card">
                        <h3>Simple GET request</h3>
                        <pre><code class="language-json">{
  "action": "RequestApi",
  "method": "GET",
  "baseUrl": "https://api.example.com",
  "path": "/users",
  "onSuccess": {
    "action": "SendMessage",
    "text": "Data received: {{response.body}}"
  }
}</code></pre>
                    </div>

                    <div class="example-card">
                        <h3>POST request with data</h3>
                        <pre><code class="language-json">{
  "action": "RequestApi",
  "method": "POST",
  "baseUrl": "https://api.example.com",
  "path": "/users",
  "body": {
    "name": "{{name}}",
    "email": "{{email}}"
  },
  "headers": {
    "Content-Type": "application/json",
    "Authorization": "Bearer {{token}}"
  },
  "onSuccess": {
    "action": "SendMessage",
    "text": "User created: {{response.body.id}}"
  }
}</code></pre>
                    </div>

                    <div class="example-card">
                        <h3>Request with parameters</h3>
                        <pre><code class="language-json">{
  "action": "RequestApi",
  "method": "GET",
  "baseUrl": "https://api.weather.com",
  "path": "/weather",
  "params": {
    "q": "Moscow",
    "appid": "{{env.WEATHER_API_KEY}}",
    "units": "metric"
  },
  "onSuccess": {
    "action": "SendMessage",
    "text": "Weather: {{response.body.main.temp}}¬∞C"
  }
}</code></pre>
                    </div>

                    <div class="example-card">
                        <h3>Request with error handling</h3>
                        <pre><code class="language-json">{
  "action": "RequestApi",
  "method": "GET",
  "baseUrl": "https://api.example.com",
  "path": "/data",
  "onStart": {
    "action": "SendMessage",
    "text": "Loading data..."
  },
  "onSuccess": {
    "action": "SendMessage",
    "text": "Data received: {{response.body}}"
  },
  "onFailure": {
    "action": "SendMessage",
    "text": "Error: {{error.message}}"
  }
}</code></pre>
                    </div>

                    <div class="example-card">
                        <h3>Error handling with server response body</h3>
                        <pre><code class="language-json">{
  "action": "RequestApi",
  "method": "POST",
  "baseUrl": "https://api.example.com",
  "path": "/users",
  "body": {
    "name": "{{name}}",
    "email": "{{email}}"
  },
  "onSuccess": {
    "action": "SendMessage",
    "text": "User created: {{response.body.id}}"
  },
  "onFailure": {
    "action": "SendMessage",
    "text": {
      "function": "JoinToString",
      "values": [
        "Error: {{error.message}}",
        "\nServer response: {{error.body.message}}",
        "\nStatus: {{error.status}}"
      ],
      "separator": ""
    }
  }
}</code></pre>
                        <p><strong>Note:</strong> The <code>{{error.body}}</code> variable contains the response body from the server, which often includes detailed error messages from the API.</p>
                    </div>

                    <div class="example-card">
                        <h3>Debugging requests with debugDescription</h3>
                        <pre><code class="language-json">{
  "action": "RequestApi",
  "method": "POST",
  "baseUrl": "https://api.example.com",
  "path": "/users",
  "body": {
    "name": "{{name}}",
    "email": "{{email}}"
  },
  "onSuccess": {
    "action": "SendMessage",
    "text": "User created: {{response.body.id}}"
  },
  "onFailure": {
    "action": "SendMessage",
    "text": {
      "function": "JoinToString",
      "values": [
        "API Error: {{error.message}}",
        "\n\nDebug information:",
        "{{error.debugDescription}}"
      ],
      "separator": ""
    }
  }
}</code></pre>
                        <p><strong>debugDescription result:</strong> Detailed information about the final HTTP request after all interpolations, including final URL, headers, request body, response status and response content.</p>
                    </div>

                    <h2>üîß How it works</h2>
                    <div class="info-card">
                        <h3>Request execution</h3>
                        <p>When executing RequestApi, the system:</p>
                        <ul>
                            <li>Interpolates all parameters</li>
                            <li>Builds full URL from baseUrl and path</li>
                            <li>Adds query parameters</li>
                            <li>Sets headers</li>
                            <li>Executes HTTP request</li>
                        </ul>
                    </div>

                    <div class="info-card">
                        <h3>Response processing</h3>
                        <p>After receiving response:</p>
                        <ul>
                            <li>Parses JSON or text depending on Content-Type</li>
                            <li>Saves response in <code>{{response.body}}</code></li>
                            <li>Saves headers in <code>{{response.headers}}</code></li>
                            <li>Executes onSuccess or onFailure</li>
                        </ul>
                    </div>

                    <h2>üîó Available variables</h2>
                    <div class="variables-grid">
                        <div class="variable-card">
                            <h4>response</h4>
                            <ul>
                                <li><code>{{response.body}}</code> - Response body</li>
                                <li><code>{{response.headers}}</code> - Response headers</li>
                                <li><code>{{response.status}}</code> - HTTP status</li>
                                <li><code>{{response.url}}</code> - Full request URL</li>
                                <li><code>{{response.debugDescription}}</code> - Detailed debug information about request and response</li>
                            </ul>
                        </div>
                        <div class="variable-card">
                            <h4>error</h4>
                            <ul>
                                <li><code>{{error.message}}</code> - Error message</li>
                                <li><code>{{error.code}}</code> - Error code</li>
                                <li><code>{{error.name}}</code> - Error type</li>
                                <li><code>{{error.body}}</code> - Response body from server (for HTTP errors)</li>
                                <li><code>{{error.stack}}</code> - Stack trace (if available)</li>
                                <li><code>{{error.debugDescription}}</code> - Detailed debug information about request and response</li>
                            </ul>
                        </div>
                    </div>

                    <h2>‚ö†Ô∏è Important notes</h2>
                    <div class="warning-card">
                        <ul>
                            <li><strong>Timeout:</strong> Default 15 seconds, can be configured</li>
                            <li><strong>Content-Type:</strong> Automatically set for JSON</li>
                            <li><strong>Errors:</strong> Network errors are handled in onFailure</li>
                            <li><strong>Performance:</strong> Requests are executed asynchronously</li>
                        </ul>
                    </div>

                    <h2>üîó Related actions</h2>
                    <div class="related-actions">
                        <a href="#" class="nav-link" data-path="actions/send-message.html">
                            <h4>SendMessage</h4>
                            <p>Display API results</p>
                        </a>
                        <a href="#" class="nav-link" data-path="actions/store.html">
                            <h4>Store</h4>
                            <p>Store data API</p>
                        </a>
                    </div>

                </section>
            
        </div>
    </div>
</body>
</html>