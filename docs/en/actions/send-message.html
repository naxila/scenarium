<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SendMessage - Scenarium Documentation</title>
</head>
<body>
    <div class="main-content">
        <div class="content">
            <section class="section">
                <h1>üì± SendMessage</h1>
                <p class="lead">Send messages to users with support for inline buttons and variable interpolation.</p>
                
                <div class="action-info">
                    <div class="info-card">
                        <h3>üìã Description</h3>
                        <p>SendMessage is the main action for sending text messages to users. Supports inline buttons, variable interpolation, and functions in message text.</p>
                    </div>
                    
                    <div class="info-card">
                        <h3>üéØ Purpose</h3>
                        <ul>
                            <li>Send text messages</li>
                            <li>Create inline buttons for navigation</li>
                            <li>Dynamic text formation with variables</li>
                            <li>Execute functions in message text</li>
                        </ul>
                    </div>
                </div>

                <h2>‚öôÔ∏è Parameters</h2>
                <div class="params-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>text</code></td>
                                <td>string | object</td>
                                <td>‚úÖ*</td>
                                <td>Message text or object with function (*not required if attachment is present)</td>
                            </tr>
                            <tr>
                                <td><code>inlineActions</code></td>
                                <td>array | array[]</td>
                                <td>‚ùå</td>
                                <td>Array of inline buttons. Supports nested arrays for button row grouping</td>
                            </tr>
                            <tr>
                                <td><code>replyKeyboard</code></td>
                                <td>object</td>
                                <td>‚ùå</td>
                                <td>Reply keyboard object with buttons, resizeKeyboard, oneTimeKeyboard fields</td>
                            </tr>
                            <tr>
                                <td><code>attachments</code></td>
                                <td>array</td>
                                <td>‚ùå</td>
                                <td>Array of attachments (photos, documents, videos, etc.). Multiple attachments are sent as media group</td>
                            </tr>
                        <tr>
                            <td><code>clearKeyboard</code></td>
                            <td>boolean</td>
                            <td>‚ùå</td>
                            <td>Clear Reply keyboard (default: true). <strong>‚ö†Ô∏è Does not work with inlineActions</strong> (Telegram API limitation). Use <code>oneTimeKeyboard: true</code> in replyKeyboard for auto-hide</td>
                        </tr>
                            <tr>
                                <td><code>markdown</code></td>
                                <td>boolean</td>
                                <td>‚ùå</td>
                                <td>Enable Markdown parsing (default: false)</td>
                            </tr>
                            <tr>
                                <td><code>onSuccess</code></td>
                                <td>action</td>
                                <td>‚ùå</td>
                                <td>Action on successful send</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h2>üìé Attachments Structure (array element)</h2>
                <div class="params-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>type</code></td>
                                <td>string</td>
                                <td>‚ùå</td>
                                <td>Attachment type: photo, document, video, audio, voice, animation, sticker (default: document)</td>
                            </tr>
                            <tr>
                                <td><code>fileId</code></td>
                                <td>string</td>
                                <td>‚ùå*</td>
                                <td>Telegram file ID (*required if no url)</td>
                            </tr>
                            <tr>
                                <td><code>url</code></td>
                                <td>string</td>
                                <td>‚ùå*</td>
                                <td>File URL (*required if no fileId)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h2>‚å®Ô∏è ReplyKeyboard Structure</h2>
                <div class="params-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>buttons</code></td>
                                <td>array</td>
                                <td>‚úÖ</td>
                                <td>Array of button rows. Each row is an array of buttons or strings</td>
                            </tr>
                            <tr>
                                <td><code>resizeKeyboard</code></td>
                                <td>boolean</td>
                                <td>‚ùå</td>
                                <td>Resize keyboard (default: true)</td>
                            </tr>
                            <tr>
                                <td><code>oneTimeKeyboard</code></td>
                                <td>boolean</td>
                                <td>‚ùå</td>
                                <td>Auto-hide keyboard after button press (default: false). <strong>Recommended true</strong> if inline buttons will follow</td>
                            </tr>
                            <tr>
                                <td><code>onSent</code></td>
                                <td>action</td>
                                <td>‚ùå</td>
                                <td>Action when button is pressed. Value is available via <code>{{replyKeyboardValue}}</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h2>üîò ReplyKeyboard Button Structure</h2>
                <div class="params-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>text</code></td>
                                <td>string</td>
                                <td>‚úÖ</td>
                                <td>Button text</td>
                            </tr>
                            <tr>
                                <td><code>value</code></td>
                                <td>string</td>
                                <td>‚ùå</td>
                                <td>Value on press (if different from text)</td>
                            </tr>
                            <tr>
                                <td><code>onClick</code></td>
                                <td>action</td>
                                <td>‚ùå</td>
                                <td>Individual action for this button</td>
                            </tr>
                            <tr>
                                <td><code>request_contact</code></td>
                                <td>boolean</td>
                                <td>‚ùå</td>
                                <td>Request user's contact</td>
                            </tr>
                            <tr>
                                <td><code>request_location</code></td>
                                <td>boolean</td>
                                <td>‚ùå</td>
                                <td>Request user's location</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                    
                <h2>üîó InlineActions Element Structure</h2>
                <div class="params-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>title</code></td>
                                <td>string</td>
                                <td>‚úÖ</td>
                                <td>Button text</td>
                            </tr>
                            <tr>
                                <td><code>onClick</code></td>
                                <td>action</td>
                                <td>‚ùå*</td>
                                <td>Action on click (*required if no url)</td>
                            </tr>
                            <tr>
                                <td><code>url</code></td>
                                <td>string</td>
                                <td>‚ùå*</td>
                                <td>URL to open (*required if no onClick)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h2>üîß inlineActions Structure</h2>
                <p>Each element of the <code>inlineActions</code> array should contain:</p>
                <div class="params-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>title</code></td>
                                <td>string</td>
                                <td>‚úÖ</td>
                                <td>Button text</td>
                            </tr>
                            <tr>
                                <td><code>onClick</code></td>
                                <td>action</td>
                                <td>‚úÖ</td>
                                <td>Action when button is clicked</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h2>üí° Usage Examples</h2>
                
                <div class="example-card">
                    <h3>Simple Message</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Hello! Welcome to the bot!"
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Message with Variables</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Hello, {{name}}! You are in the {{currentMenu}} menu"
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Message with Inline Buttons</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Choose an action:",
  "inlineActions": [
    {
      "title": "üìä Statistics",
      "onClick": {
        "action": "Navigate",
        "menuItem": "Statistics"
      }
    },
    {
      "title": "‚öôÔ∏è Settings",
      "onClick": {
        "action": "Navigate",
        "menuItem": "Settings"
      }
    }
  ]
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Message with Markdown Formatting</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "*Bold text* and _italic_\n\n`code` and [link](https://example.com)",
  "markdown": true
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Buttons in Multiple Rows (Array of Arrays)</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Choose an option:",
  "inlineActions": [
    [
      { "title": "‚¨ÖÔ∏è", "onClick": { "action": "Navigate", "menuItem": "Prev" } },
      { "title": "‚û°Ô∏è", "onClick": { "action": "Navigate", "menuItem": "Next" } }
    ],
    { "title": "üè† Home", "onClick": { "action": "Navigate", "menuItem": "Main" } }
  ]
}</code></pre>
                    <p>First two buttons will be on one row, third on a separate row.</p>
                </div>

                <div class="example-card">
                    <h3>Send Single Photo by URL</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Check out this photo!",
  "attachments": [
    {
      "type": "photo",
      "url": "https://example.com/image.jpg"
    }
  ]
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Send Multiple Photos (Media Group)</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Image gallery:",
  "attachments": [
    { "type": "photo", "url": "https://example.com/image1.jpg" },
    { "type": "photo", "url": "https://example.com/image2.jpg" },
    { "type": "photo", "fileId": "{{savedPhotoId}}" }
  ]
}</code></pre>
                    <p>Multiple attachments are grouped and sent as a single album. Text becomes caption for the first element.</p>
                </div>

                <div class="example-card">
                    <h3>Send Document by file_id</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Your document:",
  "attachments": [
    {
      "type": "document",
      "fileId": "{{savedDocumentId}}"
    }
  ]
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Reply Keyboard</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Choose an action:",
  "replyKeyboard": {
    "buttons": [
      ["üìä Statistics", "‚öôÔ∏è Settings"],
      ["‚ùì Help"]
    ],
    "resizeKeyboard": true,
    "oneTimeKeyboard": false
  }
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Reply Keyboard with Contact Request</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Share your contact:",
  "replyKeyboard": {
    "buttons": [
      [{ "text": "üì± Send Contact", "request_contact": true }]
    ],
    "resizeKeyboard": true
  }
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Reply Keyboard with Response Handling (onSent)</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Choose size:",
  "replyKeyboard": {
    "buttons": [
      [
        { "text": "S", "value": "small" },
        { "text": "M", "value": "medium" },
        { "text": "L", "value": "large" }
      ]
    ],
    "onSent": {
      "action": "SendMessage",
      "text": "You chose: {{replyKeyboardValue}}"
    }
  }
}</code></pre>
                    <p>When pressing "M" button, <code>{{replyKeyboardValue}}</code> will be "medium", and <code>{{replyKeyboardText}}</code> - "M".</p>
                </div>

                <div class="example-card">
                    <h3>Reply Keyboard with Individual Actions</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Where to go?",
  "replyKeyboard": {
    "buttons": [
      [
        { "text": "üìä Profile", "onClick": { "action": "Navigate", "menuItem": "Profile" } },
        { "text": "‚öôÔ∏è Settings", "onClick": { "action": "Navigate", "menuItem": "Settings" } }
      ]
    ]
  }
}</code></pre>
                </div>

                <div class="example-card">
                    <h3>Inline Button with URL</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Useful links:",
  "inlineActions": [
    { "title": "üìñ Documentation", "url": "https://docs.example.com" },
    { "title": "üí¨ Support Chat", "url": "https://t.me/support_chat" },
    { "title": "üè† Home", "onClick": { "action": "Navigate", "menuItem": "Main" } }
  ]
}</code></pre>
                    <p>Buttons with <code>url</code> open external links, buttons with <code>onClick</code> execute actions.</p>
                </div>

                <div class="example-card">
                    <h3>Explicit Keyboard Clear</h3>
                    <pre><code class="language-json">{
  "action": "SendMessage",
  "text": "Keyboard cleared",
  "clearKeyboard": true
}</code></pre>
                </div>

                <h2>üîó Available Variables</h2>
                <div class="variables-grid">
                    <div class="variable-card">
                        <h4>userContext</h4>
                        <ul>
                            <li><code>{{userId}}</code> - User ID</li>
                            <li><code>{{name}}</code> - User name</li>
                            <li><code>{{currentMenu}}</code> - Current menu</li>
                            <li><code>{{lastMessageId}}</code> - Last message ID</li>
                        </ul>
                    </div>
                    <div class="variable-card">
                        <h4>scenarioContext</h4>
                        <ul>
                            <li><code>{{apiUrl}}</code> - API URL</li>
                            <li><code>{{version}}</code> - Scenario version</li>
                        </ul>
                    </div>
                    <div class="variable-card">
                        <h4>localContext</h4>
                        <ul>
                            <li><code>{{messageId}}</code> - Current message ID</li>
                            <li><code>{{response}}</code> - API response</li>
                            <li><code>{{error}}</code> - Error</li>
                        </ul>
                    </div>
                    <div class="variable-card">
                        <h4>input</h4>
                        <ul>
                            <li><code>{{userName}}</code> - Entered name</li>
                            <li><code>{{email}}</code> - Entered email</li>
                        </ul>
                    </div>
                </div>

                <h2>‚ö†Ô∏è Important Notes</h2>
                <div class="warning-card">
                    <ul>
                        <li><strong>Empty text:</strong> If text is empty or contains only spaces and no attachment, message will not be sent</li>
                        <li><strong>Inline buttons:</strong> Maximum 8 buttons per row, total number is unlimited</li>
                        <li><strong>Button grouping:</strong> Use nested arrays to place multiple buttons in one row</li>
                        <li><strong>Message size:</strong> Maximum 4096 characters for one message</li>
                        <li><strong>Interpolation:</strong> All variables are interpolated before sending</li>
                        <li><strong>Functions in text:</strong> Nested functions are supported for complex logic</li>
                        <li><strong>Markdown parsing:</strong> When Markdown is enabled (<code>markdown: true</code>), the message may fail to send due to unescaped special characters (*, _, [, ], (, ), ~, `, >, #, +, -, =, |, {, }, ., !). Markdown is disabled by default to avoid such issues.</li>
                        <li><strong>Reply keyboard:</strong> Use <code>clearKeyboard: true</code> to explicitly clear the keyboard</li>
                        <li><strong>Reply keyboard with onSent:</strong> User response is available in <code>{{replyKeyboardValue}}</code> (button value) and <code>{{replyKeyboardText}}</code> (text)</li>
                        <li><strong>Attachments:</strong> Supports sending by fileId (for files already uploaded to Telegram) and by URL</li>
                        <li><strong>Media group:</strong> Multiple attachments are grouped into an album. Supported types: photo, video, document, audio</li>
                    </ul>
                </div>
            </section>
        </div>
    </div>
</body>
</html>