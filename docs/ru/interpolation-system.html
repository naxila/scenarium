<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система интерполяции - Scenarium</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-content">
                <div class="logo">
                    <h1>Scenarium</h1>
                    <span class="version">v0.1.0-alpha</span>
                </div>
                <nav class="nav-menu">
                    <a href="#" class="nav-link" data-path="index.html">Главная</a>
                    <a href="#" class="nav-link" data-path="interpolation-system.html" class="active">Система интерполяции</a>
                    <a href="#" class="nav-link" data-path="actions/index.html">Действия</a>
                    <a href="#" class="nav-link" data-path="functions/index.html">Функции</a>
                    <a href="#" class="nav-link" data-path="examples.html">Примеры</a>
                </nav>
            </div>
        </div>
        
        <div class="main-content">
            <div class="content">
                <h1>Система интерполяции</h1>
                
                <p>Система интерполяции предоставляет унифицированный и интуитивный способ доступа к переменным в сценариях, действиях и функциях. Она работает аналогично области видимости переменных в языках программирования.</p>
                
                <div class="info-card">
                    <h3>⚡ Важно</h3>
                    <p>Интерполяция работает <strong>только с переменными</strong>. Для выполнения функций используйте объектный синтаксис в действиях и функциях.</p>
                </div>

                <h2>Источники данных (порядок приоритета)</h2>
                
                <div class="priority-list">
                    <div class="priority-item">
                        <h3>1. Локальный контекст (высший приоритет)</h3>
                        <p>Переменные, созданные действиями и функциями в их локальной области видимости.</p>
                        <div class="code-example">
                            <code>{{tempValue}}</code> - Прямой доступ<br>
                            <code>{{local.tempValue}}</code> - Явный префикс
                        </div>
                    </div>
                    
                    <div class="priority-item">
                        <h3>2. Параметры функций/действий</h3>
                        <p>Параметры, передаваемые в функции и действия.</p>
                        <div class="code-example">
                            <code>{{param1}}</code> - Прямой доступ<br>
                            <code>{{params.param1}}</code> - Явный префикс
                        </div>
                    </div>
                    
                    <div class="priority-item">
                        <h3>3. Данные сценария</h3>
                        <p>Переменные, определенные в блоке <code>data</code> сценария.</p>
                        <div class="code-example">
                            <code>{{apiUrl}}</code> - Прямой доступ<br>
                            <code>{{data.apiUrl}}</code> - Явный префикс
                        </div>
                    </div>
                    
                    <div class="priority-item">
                        <h3>4. Окружение (низший приоритет)</h3>
                        <p>Системные переменные, автоматически предоставляемые системой интерполяции.</p>
                        <div class="code-example">
                            <code>{{timestamp}}</code> - Прямой доступ<br>
                            <code>{{env.timestamp}}</code> - Явный префикс
                        </div>
                        
                        <h4>Доступные системные переменные:</h4>
                        <ul>
                            <li><code>{{timestamp}}</code> или <code>{{env.timestamp}}</code> - Текущая дата и время в ISO формате</li>
                            <li><code>{{version}}</code> или <code>{{env.version}}</code> - Версия системы (0.1.0-alpha)</li>
                            <li><code>{{date}}</code> или <code>{{env.date}}</code> - Текущая дата в формате YYYY-MM-DD</li>
                            <li><code>{{time}}</code> или <code>{{env.time}}</code> - Текущее время в формате HH:MM:SS</li>
                        </ul>
                        
                        <p><strong>Примечание:</strong> Эти переменные генерируются автоматически и всегда доступны в любом контексте интерполяции.</p>
                    </div>
                </div>

                <h2>Управление областями видимости</h2>
                
                <p>Локальный контекст работает как области видимости функций в языках программирования:</p>
                
                <ul>
                    <li><strong>Вложенные области:</strong> Дочерние функции могут обращаться к переменным родителя</li>
                    <li><strong>Затенение переменных:</strong> Локальные переменные могут переопределять родительские</li>
                    <li><strong>Автоматическая очистка:</strong> Области очищаются при завершении функций/действий</li>
                    <li><strong>Изоляция:</strong> Каждая функция/действие управляет только своей областью</li>
                </ul>

                <h2>Примеры использования</h2>

                <h3>Базовый доступ к переменным</h3>
                <div class="code-block">
                    <pre><code>// Данные сценария
{
  "data": {
    "userName": "Иван",
    "apiUrl": "https://api.example.com"
  }
}

// В действии
"text": "Привет {{userName}}! API: {{apiUrl}}"
// Результат: "Привет Иван! API: https://api.example.com"</code></pre>
                </div>

                <h3>Локальный контекст в действиях</h3>
                <div class="code-block">
                    <pre><code>// Действие автоматически создает локальную область видимости
// Переменные доступны для интерполяции

// В тексте действия
"text": "Сообщение {{messageId}} отправлено: {{sent}}"
// Результат: "Сообщение 123 отправлено: true"</code></pre>
                </div>

                <h3>Вложенные области функций</h3>
                <div class="code-block">
                    <pre><code>// Функции автоматически наследуют родительскую область видимости
// Дочерние функции могут получить доступ к переменным родителя
// Локальные переменные могут переопределить переменные родителя
// Области видимости автоматически очищаются при завершении функций

// Пример: Функция A устанавливает x=10, Функция B может получить доступ к x
// Функция B устанавливает y=20, Функция C может получить доступ к x и y
// Когда функции завершаются, их локальные переменные очищаются</code></pre>
                </div>

                <h3>Явные префиксы</h3>
                <div class="code-block">
                    <pre><code>// Принудительное указание источника данных
"text": "Локальное: {{local.temp}}, Данные: {{data.userName}}, Окружение: {{env.timestamp}}"

// Доступ к вложенным объектам
"apiUrl": "{{data.api.baseUrl}}/{{data.api.version}}/users"</code></pre>
                </div>


                <h2>Лучшие практики</h2>

                <ul>
                    <li><strong>Используйте прямой доступ:</strong> Предпочитайте <code>{{variableName}}</code> вместо <code>{{local.variableName}}</code> когда возможно</li>
                    <li><strong>Явные префиксы:</strong> Используйте префиксы когда нужно явно указать источник данных</li>
                    <li><strong>Управление областями:</strong> Области видимости автоматически управляются системой</li>
                    <li><strong>Именование переменных:</strong> Используйте описательные имена чтобы избежать конфликтов</li>
                    <li><strong>Вложенные объекты:</strong> Используйте точечную нотацию для доступа к вложенным объектам</li>
                    <li><strong>Функции в интерполяции:</strong> Для выполнения функций используйте объектный синтаксис в действиях, а не прямую интерполяцию</li>
                </ul>

                <h2>⚠️ Ограничения</h2>

                <div class="warning-card">
                    <h3>Функции в строковой интерполяции</h3>
                    <p>Функции не могут выполняться напрямую в строковой интерполяции из-за их асинхронной природы. Вместо этого используйте объектный синтаксис:</p>
                    
                    <div class="code-example">
                        <strong>❌ Неправильно:</strong><br>
                        <code>"text": "Результат: {{Plus:values:5:10:15}}"</code><br><br>
                        
                        <strong>✅ Правильно:</strong><br>
                        <code>"text": {<br>
                        &nbsp;&nbsp;"function": "JoinToString",<br>
                        &nbsp;&nbsp;"values": ["Результат: ", {"function": "Plus", "values": [5, 10, 15]}]<br>
                        }</code>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>

