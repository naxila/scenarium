<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Scenarium</title>
</head>
<body>
    <div class="main-content">
        <div class="content">
            <section class="section">
                <h1>‚ö° –ö–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h1>
                <p class="lead">–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –≤–∞—à–∏—Ö Telegram-–±–æ—Ç–æ–≤.</p>
                
                <h2>–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è?</h2>
                <p>–ö–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞—Å—à–∏—Ä–∏—Ç—å Scenarium —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é. –í—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏, –Ω–µ –ø–æ–∫—Ä—ã—Ç—ã–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏.</p>
                
                <h2>–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                <p>–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç <code>BaseActionProcessor</code>:</p>
                
                <div class="code-block">
                    <h3>–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π</h3>
                    <pre><code class="language-typescript">import { BaseActionProcessor } from 'scenarium';

class MyCustomAction extends BaseActionProcessor {
  get actionType() {
    return 'MyCustomAction';
  }

  async process(action: any, context: any): Promise<void> {
    // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –∑–¥–µ—Å—å
  }
}</code></pre>
                </div>
                
                <h2>–ü—Ä–∏–º–µ—Ä: –î–µ–π—Å—Ç–≤–∏–µ —Å–±—Ä–æ—Å–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è</h2>
                <div class="example-card">
                    <h3>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏—è —Å–±—Ä–æ—Å–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è</h3>
                    <pre><code class="language-typescript">const { BaseActionProcessor } = require('scenarium/dist/actions/BaseAction');

class ResetPersonalScenarioAction extends BaseActionProcessor {
  get actionType() {
    return 'ResetPersonalScenario';
  }

  async process(action, context) {
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
    const interpolationContext = this.createInterpolationContext(context);
    
    // –°–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∫–æ—É–ø –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è
    interpolationContext.local.createScope();
    
    try {
      // –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ–º –¥–µ–π—Å—Ç–≤–∏–µ —Å —Ç–µ–∫—É—â–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
      const interpolatedAction = this.interpolate(action, interpolationContext);
      const { userId } = interpolatedAction;
      
      // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π chatId –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      const chatId = context.chatId;
      if (!chatId) {
        throw new Error('ChatId not found in context');
      }

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
      interpolationContext.local.setVariable('userId', userId);
      interpolationContext.local.setVariable('chatId', chatId);
      interpolationContext.local.setVariable('status', 'processing');

      // –£–¥–∞–ª—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
      if (global.personalScenarios) {
        global.personalScenarios.delete(chatId);
        interpolationContext.local.setVariable('scenarioDeleted', true);
      }
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
      const advancedBotInstance = global.botManager?.getBotInstance('advanced-bot');
      
      if (advancedBotInstance) {
        const { ScenarioLoader } = require('scenarium');
        const defaultScenario = await ScenarioLoader.loadScenario('./scenarios/advanced-bot');
        advancedBotInstance.updateScenario(defaultScenario);
        
        interpolationContext.local.setVariable('status', 'completed');
        interpolationContext.local.setVariable('scenarioReset', true);
        
        await this.sendMessage(context, 
          'üîÑ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–±—Ä–æ—à–µ–Ω!\n\n' +
          '–°—Ü–µ–Ω–∞—Ä–∏–π —Å–±—Ä–æ—à–µ–Ω –¥–ª—è –í–µ–¥–æ–º–æ–≥–æ –±–æ—Ç–∞ (advanced-bot).\n' +
          '–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [@boobsbbot](https://t.me/boobsbbot) –∏ –≤—ã–∑–æ–≤–∏—Ç–µ /start –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.'
        );
      }
    } finally {
      // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∫–æ—É–ø –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è
      interpolationContext.local.clearScope();
    }
  }

  async sendMessage(context, text, options = {}) {
    const { bot, chatId } = context;
    if (bot && chatId) {
      try {
        return await bot.sendMessage(chatId, text, options);
      } catch (error) {
        console.error('Failed to send message:', error);
      }
    }
  }
}

module.exports = ResetPersonalScenarioAction;</code></pre>
                </div>
                
                <h2>–ü—Ä–∏–º–µ—Ä: –î–µ–π—Å—Ç–≤–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –≤–≤–æ–¥–∞</h2>
                <div class="example-card">
                    <h3>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–≤–æ–¥–æ–º</h3>
                    <pre><code class="language-typescript">const { BaseActionProcessor } = require('scenarium/dist/actions/BaseAction');
const { ActionRegistry } = require('scenarium');

class MultiInputAction extends BaseActionProcessor {
  get actionType() {
    return 'MultiInput';
  }

  async process(action, context) {
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
    const interpolationContext = this.createInterpolationContext(context);
    
    // –°–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∫–æ—É–ø –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è
    interpolationContext.local.createScope();
    
    try {
      // –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ–º –¥–µ–π—Å—Ç–≤–∏–µ —Å —Ç–µ–∫—É—â–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
      const interpolatedAction = this.interpolate(action, interpolationContext);
      const { userId, botName, maxInputs = 3 } = interpolatedAction;
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
      interpolationContext.local.setVariable('userId', userId);
      interpolationContext.local.setVariable('botName', botName);
      interpolationContext.local.setVariable('maxInputs', maxInputs);
      interpolationContext.local.setVariable('actionId', `multi_${userId}_${Date.now()}`);
      
      const bot = context.bot;
      const chatId = context.chatId;
      
      await this.sendMessage(context, `üìù –û—Ç–ø—Ä–∞–≤—å—Ç–µ ${maxInputs} —Å–æ–æ–±—â–µ–Ω–∏–π. –û—Å—Ç–∞–ª–æ—Å—å: ${maxInputs}`);
      
      const actionId = interpolationContext.local.getVariable('actionId');
      const inputs = [];
    
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
      interpolationContext.local.setVariable('status', 'waiting');
      interpolationContext.local.setVariable('inputsCollected', 0);
      
      // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–≤–æ–¥–æ–≤
      ActionRegistry.setActionWaiting(
        actionId,
        userId,
        botName,
        'message',
        async (input, state) => {
          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–≤–æ–¥
          const text = input.data.text;
          inputs.push(text);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
          interpolationContext.local.setVariable('inputsCollected', inputs.length);
          
          const remaining = maxInputs - state.inputCount;
          
          if (remaining > 0) {
            await this.sendMessage(context, `üìù –ü–æ–ª—É—á–µ–Ω–æ: ${state.inputCount}/${maxInputs}. –û—Å—Ç–∞–ª–æ—Å—å: ${remaining}`);
            return true; // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∂–¥–∞—Ç—å
          } else {
            interpolationContext.local.setVariable('status', 'completed');
            await this.sendMessage(context, `‚úÖ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω—ã: ${inputs.join(', ')}`);
            return false; // –ó–∞–≤–µ—Ä—à–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ
          }
        },
        async (result) => {
          // –î–µ–π—Å—Ç–≤–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
          console.log(`–ü–æ–ª—É—á–µ–Ω–æ ${result.inputCount} —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}`);
          await this.sendMessage(context, `üéâ –°–æ–±—Ä–∞–Ω–æ ${result.inputCount} —Å–æ–æ–±—â–µ–Ω–∏–π!`);
        },
        {
          maxInputs: maxInputs,
          timeout: 60000 // 1 –º–∏–Ω—É—Ç–∞ —Ç–∞–π–º–∞—É—Ç
        }
      );
    } finally {
      // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∫–æ—É–ø –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è
      interpolationContext.local.clearScope();
    }
  }

  async sendMessage(context, text, options = {}) {
    const { bot, chatId } = context;
    if (bot && chatId) {
      try {
        return await bot.sendMessage(chatId, text, options);
      } catch (error) {
        console.error('Failed to send message:', error);
      }
    }
  }
}

module.exports = MultiInputAction;</code></pre>
                </div>

                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π</h2>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>ActionRegistry</code> –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏—Ö –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:</p>
                
                <div class="code-block">
                    <h3>–ü—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h3>
                    <pre><code class="language-typescript">const { ActionRegistry } = require('scenarium');
const ResetPersonalScenarioAction = require('./actions/ResetPersonalScenarioAction');
const MultiInputAction = require('./actions/MultiInputAction');

// –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
ActionRegistry.registerAction(new ResetPersonalScenarioAction());
ActionRegistry.registerAction(new MultiInputAction());</code></pre>
                </div>
                
                <h2>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö</h2>
                <p>–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à–µ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö:</p>
                
                <div class="example-card">
                    <h3>–°—Ü–µ–Ω–∞—Ä–∏–π —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏</h3>
                    <pre><code class="language-json">{
  "menuItems": {
    "Main": {
      "onNavigation": {
        "action": "SendMessage",
        "text": "üéØ –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
        "inlineActions": [
          {
            "title": "üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π",
            "onClick": {
              "action": "ResetPersonalScenario",
              "userId": "{{userId}}"
            }
          },
          {
            "title": "üìù –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–≤–æ–¥",
            "onClick": {
              "action": "MultiInput",
              "userId": "{{userId}}",
              "botName": "{{botName}}",
              "maxInputs": 3
            }
          }
        ]
      }
    }
  }
}</code></pre>
                </div>
                
                <h2>–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</h2>
                <ul>
                    <li><strong>–ù–∞—Å–ª–µ–¥—É–π—Ç–µ—Å—å –æ—Ç BaseActionProcessor</strong> - —ç—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º</li>
                    <li><strong>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–∫–æ—É–ø—ã</strong> - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ –æ—á–∏—â–∞–π—Ç–µ —Å–∫–æ—É–ø—ã –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è</li>
                    <li><strong>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</strong> - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ try/finally –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤</li>
                    <li><strong>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é</strong> - –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ createInterpolationContext –∏ interpolate –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏</li>
                    <li><strong>–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞</strong> - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ActionRegistry.setActionWaiting –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</li>
                    <li><strong>–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –æ–¥–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</strong> - –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–µ—à–∞—Ç—å –æ–¥–Ω—É –∑–∞–¥–∞—á—É</li>
                    <li><strong>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞</strong> - actionType –¥–æ–ª–∂–µ–Ω —á–µ—Ç–∫–æ –æ—Ç—Ä–∞–∂–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</li>
                </ul>
            </section>
        </div>
    </div>
</body>
</html>
